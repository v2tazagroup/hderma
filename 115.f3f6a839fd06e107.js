"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[115],{3115:(J,p,s)=>{s.r(p),s.d(p,{DonhangModule:()=>w});var g=s(4755),m=s(2480),C=s(3144),f=s(9401),S=s(2944),T=s(4800),x=s(4224),b=s(964),y=s(3276),Z=s(2611),d=s(3204),D=s(5258),H=s(2719),i=s(2223),A=s(2917),U=s(4289),E=s(6757),F=s(9016),O=s(4300),M=s(6286),Y=s(3630);function P(h,r){if(1&h&&(i.TgZ(0,"div",9)(1,"div"),i._uU(2),i.qZA(),i.TgZ(3,"div",10)(4,"div",11),i._uU(5),i.ALo(6,"number"),i.qZA(),i.TgZ(7,"div",6),i._uU(8),i.ALo(9,"number"),i.qZA()()()),2&h){const t=r.$implicit,e=r.index;i.xp6(2),i.AsE("",e+1," ",t.Product.Tieude,""),i.xp6(3),i.AsE("",t.Soluong,"x",i.xi3(6,5,t.Dongia,"1.0-2"),""),i.xp6(3),i.hij("",i.xi3(9,8,t.Soluong*t.Dongia,"1.0-2")," \u0111")}}let j=(()=>{class h{constructor(t,e,n,a,c,v,G,L){this.fb=t,this.donhangService=e,this._sanphamService=n,this._linkService=a,this._notifierService=c,this._tichdiemService=v,this.dialog=G,this.route=L,this.displayedColumns1=["TenSP","Soluong","Dongia","Ghichu","Trangthai"],this.dataSource1=new d.by,this.displayedColumns=["Hoten","SDT","Diachi","Ngaytao","Trangthai","action"],this.TTDonhang=H.C,this.isOpen=!1,this.DonHangs=[],this.users={},this.arr=[],this.customer={},this.customer_diem={},this.selectRow={},this.DHChitiet={},this._transformer=(o,u)=>({expandable:!!o.children&&o.children.length>0,level:u,...o}),this.treeControl=new b.C2(o=>o.level,o=>o.expandable),this.treeFlattener=new D.JZ(this._transformer,o=>o.level,o=>o.expandable,o=>o.children),this.hasChild=(o,u)=>u.expandable,this.hasNoContent=(o,u)=>""===u.name,this.dataSourceTree=new D.kc(this.treeControl,this.treeFlattener),this.nest=(o,u="",B="pid")=>o?.filter(l=>l[B]==u).map(l=>({...l,children:this.nest(o,l.id)}))}ngOnInit(){this._sanphamService.getProduct().subscribe(),this._sanphamService.products$.subscribe(t=>this.products=t),this.route.params.subscribe(t=>{this.donhangService.getOneDonhang(t.id).subscribe(),this.donhangService.donhang1$.subscribe(e=>{e&&(this.DHChitiet=e,console.log(e.Donhangchitiets),this.dataSource=new d.by(e.Donhangchitiets),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)})}),this._linkService.getLink().subscribe()}Total(t){return t.reduce((e,n)=>e+n.Soluong*n.Dongia,0)}Findbyid(t,e){const n=e.find(a=>a.id==t);return n?n.Tieude:""}selectTrangthai(t,e){3==e&&(this.customer_diem.idUser=t.idKH,this.customer_diem.idDonHang=t.id,this.customer_diem.Diemcap=this.customer_diem.Diemqua=t.Donhangchitiets.reduce((n,a)=>n+a.Dongia,0)/1e4,this._tichdiemService.createTichdiem(this.customer_diem).subscribe(n=>{this._tichdiemService.getCustomerByidUser(n.idUser).subscribe(a=>{a?(this.customer=a,this.customer.TongDiemcap+=n.Diemcap,this.customer.TongDiemqua+=n.Diemqua,this._tichdiemService.updateCustomer(this.customer).subscribe(c=>{this.customer={}}),this.ngOnInit()):(this.customer.idUser=n.idUser,this.customer.TongDiemcap=n.Diemcap,this.customer.TongDiemqua=n.Diemqua,this._tichdiemService.createCustomer(this.customer).subscribe(c=>{this.customer={}}),this.ngOnInit())})})),delete t.Donhangchitiets,t.Trangthai=e,this.donhangService.updateDonhang(t).subscribe(),this._notifierService.notify("success","C\u1eadp Nh\u1eadt \u0110\u01a1n H\xe0ng Th\xe0nh C\xf4ng")}getParent(t,e){let n=t.find(a=>a.pid==e);return n&&(this.arr.push(n),this.getParent(t,n.id)),n}openDialog(t,e){this.dataSourceTree.data=[],this.arr=[],this.dialog.open(e),this._linkService.getLinkDetail(t.idGioithieu).subscribe(n=>{n&&this._linkService.links$.subscribe(a=>{if(a){if(""!=n.pid){let c=a.find(v=>v.id==n.pid);this.arr.push(c)}this.arr.push(n),n.isCheck=!0,this.getParent(a,n.id),this.dataSourceTree.data=this.nest(this.arr)}})})}SelectDonhang(t){this.dataSource1=new d.by(t.Donhangchitiets)}applyFilter(t){this.dataSource.filter=t.target.value.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}toggle(t,e){this.selectRow=e,this.triggerOrigin=t,this.isOpen=!this.isOpen}filterDonhang(t){this.dataSource=new d.by(this.DonHangs.filter(e=>e.Hoten.toLowerCase().includes(t))),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}}return h.\u0275fac=function(t){return new(t||h)(i.Y36(f.qu),i.Y36(A.f),i.Y36(U.M),i.Y36(E.M),i.Y36(F.lG),i.Y36(O.n),i.Y36(M.uw),i.Y36(m.gz))},h.\u0275cmp=i.Xpm({type:h,selectors:[["tazagroup-chitiet"]],viewQuery:function(t,e){if(1&t&&(i.Gf(y.NW,5),i.Gf(Z.YE,5)),2&t){let n;i.iGM(n=i.CRH())&&(e.paginator=n.first),i.iGM(n=i.CRH())&&(e.sort=n.first)}},decls:24,vars:12,consts:[[1,"flex","flex-col","w-full","p-4"],[1,"text-xl","text-center","py-4","font-bold"],[1,"flex","flex-row","space-x-2"],[1,"flex","flex-col","space-y-2","bg-white","p-6","rounded-md","shadow"],["class","flex flex-col",4,"ngFor","ngForOf"],[1,"flex","flex-row","justify-between","font-bold"],[1,"text-blue-500"],[1,"flex","flex-col","space-y-3","bg-white","p-6","rounded-md","shadow","w-2/5"],[1,"flex","flex-row"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between"],[1,"italic"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0)(1,"div",1),i._uU(2,"\u0110\u01a1n h\xe0ng chi ti\u1ebft"),i.qZA(),i.TgZ(3,"div",2)(4,"div",3),i.YNc(5,P,10,11,"div",4),i._UZ(6,"mat-divider"),i.TgZ(7,"div",5)(8,"div"),i._uU(9,"T\u1ed5ng C\u1ed9ng"),i.qZA(),i.TgZ(10,"div",6),i._uU(11),i.ALo(12,"number"),i.qZA()()(),i.TgZ(13,"div",7)(14,"div"),i._uU(15,"Kh\xe1ch h\xe0ng"),i.qZA(),i.TgZ(16,"div",8),i._uU(17),i.qZA(),i.TgZ(18,"div",8),i._uU(19),i.qZA(),i.TgZ(20,"div",8),i._uU(21),i.qZA(),i.TgZ(22,"div",8),i._uU(23),i.qZA()()()()),2&t&&(i.xp6(5),i.Q6J("ngForOf",e.DHChitiet.Donhangchitiets),i.xp6(6),i.hij("",i.xi3(12,9,e.Total(e.DHChitiet.Donhangchitiets),"1.0-2"),"\u0111 \u0111"),i.xp6(6),i.hij(" M\xe3 \u0110\u01a1n : ",e.DHChitiet.MaDonHang," "),i.xp6(2),i.hij("H\u1ecd T\xean : ",e.DHChitiet.Hoten,""),i.xp6(2),i.hij("S\u1ed1 \u0110i\u1ec7n Tho\u1ea1i : ",e.DHChitiet.SDT,""),i.xp6(2),i.HOy("\u0110\u1ecba Ch\u1ec9 : ",e.DHChitiet.Diachi.Diachi+","||0," ",e.DHChitiet.Diachi.Phuong+","||0," ",e.DHChitiet.Diachi.Quan+","||0," ",e.DHChitiet.Diachi.Tinh||""," "))},dependencies:[g.sg,Y.d,g.JJ]}),h})(),w=(()=>{class h{}return h.\u0275fac=function(t){return new(t||h)},h.\u0275mod=i.oAB({type:h}),h.\u0275inj=i.cJS({imports:[g.ez,f.u5,C.JF,S.q,f.UX,T.Z_,m.Bz.forChild([{path:"",component:x.F,children:[{path:":id",component:j}]}]),m.Bz]}),h})()}}]);