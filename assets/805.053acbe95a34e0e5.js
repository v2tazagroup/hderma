"use strict";(self.webpackChunkhdermaapp=self.webpackChunkhdermaapp||[]).push([[805],{805:(se,S,o)=>{o.r(S),o.d(S,{DonhangModule:()=>v});var m=o(6895),u=o(5715),M=o(529),d=o(4006),j=o(5291),V=o(9102),P=o(9485),x=o(8739),T=o(6308),c=o(3626),b=o(9849),y=o(7889),E=o(3601),_=o(7851),p=o(5423),w=o(3337),O=o(7317),e=o(4650),I=o(9016),k=o(5938),$=o(4859),C=o(9549),A=o(4144),D=o(8255),H=o(3267),B=o(266),F=o(8184);function G(r,t){1&r&&(e.\u0275\u0275elementStart(0,"th",33),e.\u0275\u0275text(1,"M\xe3 \u0110H"),e.\u0275\u0275elementEnd())}function Q(r,t){1&r&&(e.\u0275\u0275elementStart(0,"span",38),e.\u0275\u0275text(1,"visibility"),e.\u0275\u0275elementEnd())}const R=function(r){return[r]};function U(r,t){if(1&r){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"td",34),e.\u0275\u0275listener("click",function(){const s=e.\u0275\u0275restoreView(n).$implicit,l=e.\u0275\u0275nextContext();return e.\u0275\u0275reference(2).open(),e.\u0275\u0275resetView(l.Daxem(s,"Status",1))}),e.\u0275\u0275elementStart(1,"div",35)(2,"div",36)(3,"span"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,Q,2,0,"span",37),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"span"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"date"),e.\u0275\u0275elementEnd()()()}if(2&r){const n=t.$implicit;e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(7,R,n.id)),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(n.MaDonHang),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",1==n.Status),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(8,4,n.Ngaytao,"hh:mm:ss dd/MM/yy"))}}function z(r,t){1&r&&(e.\u0275\u0275elementStart(0,"th",33),e.\u0275\u0275text(1,"H\u1ecd T\xean"),e.\u0275\u0275elementEnd())}function N(r,t){if(1&r&&(e.\u0275\u0275elementStart(0,"td",39)(1,"div",35)(2,"span"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"span"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"span"),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&r){const n=t.$implicit;e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.Hoten),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(n.SDT),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate4(" ",n.Diachi.Diachi+","||0," ",n.Diachi.Phuong+","||0," ",n.Diachi.Quan+","||0," ",n.Diachi.Tinh||""," ")}}function L(r,t){1&r&&(e.\u0275\u0275elementStart(0,"th",33),e.\u0275\u0275text(1,"\u0110\u1ecba Ch\u1ec9"),e.\u0275\u0275elementEnd())}function J(r,t){if(1&r){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"td",39)(1,"div",40)(2,"span"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",41)(5,"mat-form-field",42)(6,"mat-label"),e.\u0275\u0275text(7,"Ghi Ch\xfa"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"textarea",43),e.\u0275\u0275listener("ngModelChange",function(a){const l=e.\u0275\u0275restoreView(n).$implicit;return e.\u0275\u0275resetView(l.Ghichu=a)}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"button",44),e.\u0275\u0275listener("click",function(){const s=e.\u0275\u0275restoreView(n).$implicit,l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.UpdateStatus(s,"Ghichu",s.Ghichu))}),e.\u0275\u0275elementStart(10,"span",45),e.\u0275\u0275text(11,"done"),e.\u0275\u0275elementEnd()()()()()}if(2&r){const n=t.$implicit;e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate4(" ",n.Diachi.Diachi+","||0," ",n.Diachi.Phuong+","||0," ",n.Diachi.Quan+","||0," ",n.Diachi.Tinh||""," "),e.\u0275\u0275advance(5),e.\u0275\u0275property("value",n.Ghichu)("ngModel",n.Ghichu)}}function K(r,t){1&r&&(e.\u0275\u0275elementStart(0,"th",33),e.\u0275\u0275text(1,"Ghi Ch\xfa"),e.\u0275\u0275elementEnd())}function X(r,t){1&r&&e.\u0275\u0275element(0,"td",39)}function W(r,t){1&r&&(e.\u0275\u0275elementStart(0,"th",33),e.\u0275\u0275text(1,"Tr\u1ea1ng th\xe1i"),e.\u0275\u0275elementEnd())}function Z(r,t){if(1&r){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",51),e.\u0275\u0275listener("click",function(){const s=e.\u0275\u0275restoreView(n).$implicit,l=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(l.selectTrangthai(l.selectRow,s.id))}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(2&r){const n=t.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(n.Tieude)}}function Y(r,t){if(1&r){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"td",39)(1,"button",46),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"mat-menu",null,47),e.\u0275\u0275template(5,Z,2,1,"button",48),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"span",49,50),e.\u0275\u0275listener("click",function(){const s=e.\u0275\u0275restoreView(n).$implicit,l=e.\u0275\u0275reference(7),h=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(h.toggle(l,s))}),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()}if(2&r){const n=t.$implicit,i=e.\u0275\u0275reference(4),a=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275classMapInterpolate1("cursor-pointer p-2 rounded text-white ",1==n.Trangthai?"bg-blue-500":2==n.Trangthai?"bg-yellow-500":3==n.Trangthai?"bg-green-500":4==n.Trangthai?"bg-red-500":"",""),e.\u0275\u0275property("matMenuTriggerFor",i),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",a.Findbyid(n.Trangthai,a.TTDonhang),"\n"),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",a.TTDonhang),e.\u0275\u0275advance(1),e.\u0275\u0275classMapInterpolate1("cursor-pointer p-2 rounded text-white ",1==n.Trangthai?"bg-blue-500":2==n.Trangthai?"bg-yellow-500":3==n.Trangthai?"bg-green-500":4==n.Trangthai?"bg-red-500":"",""),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",a.Findbyid(n.Trangthai,a.TTDonhang)," ")}}function q(r,t){1&r&&e.\u0275\u0275element(0,"tr",52)}function ee(r,t){1&r&&e.\u0275\u0275element(0,"tr",53)}function te(r,t){1&r&&(e.\u0275\u0275elementStart(0,"tr",54)(1,"td",55),e.\u0275\u0275text(2,"Kh\xf4ng T\xecm Th\u1ea5y"),e.\u0275\u0275elementEnd()())}function ne(r,t){if(1&r){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",58),e.\u0275\u0275listener("click",function(){const s=e.\u0275\u0275restoreView(n).$implicit,l=e.\u0275\u0275nextContext(2);return l.selectTrangthai(l.selectRow,s.id),e.\u0275\u0275resetView(l.isOpen=!l.isOpen)}),e.\u0275\u0275elementStart(1,"div",14),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()}if(2&r){const n=t.$implicit;e.\u0275\u0275classMapInterpolate1("hover:text-white px-3 py-1 cursor-pointer  ",1==n.id?"hover:bg-blue-500":2==n.id?"hover:bg-yellow-500":3==n.id?"hover:bg-green-500":4==n.id?"hover:bg-red-500":"",""),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",n.Tieude," ")}}function ie(r,t){if(1&r&&(e.\u0275\u0275elementStart(0,"div",56),e.\u0275\u0275template(1,ne,3,4,"div",57),e.\u0275\u0275elementEnd()),2&r){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",n.TTDonhang)}}const ae=function(){return[5,10,25,100]};class g{fb;donhangService;_sanphamService;_linkService;_notifierService;_tichdiemService;dialog;displayedColumns1=["TenSP","Soluong","Dongia","Khuyenmai","Ghichu","Trangthai","Gioithieu"];dataSource1=new c.by;dataSource;displayedColumns=["MaDonHang","Hoten","Diachi","Trangthai"];TTDonhang=w.C;isOpen=!1;CDonhang;DonHangs=[];products;users={};arr=[];customer={};customer_diem={};landingpageForm;selectRow={};paginator;sort;triggerOrigin;_transformer=(t,n)=>({expandable:!!t.children&&t.children.length>0,level:n,...t});treeControl=new _.C2(t=>t.level,t=>t.expandable);treeFlattener=new p.JZ(this._transformer,t=>t.level,t=>t.expandable,t=>t.children);hasChild=(t,n)=>n.expandable;hasNoContent=(t,n)=>""===n.name;dataSourceTree=new p.kc(this.treeControl,this.treeFlattener);constructor(t,n,i,a,s,l,h){this.fb=t,this.donhangService=n,this._sanphamService=i,this._linkService=a,this._notifierService=s,this._tichdiemService=l,this.dialog=h}ngOnInit(){this._sanphamService.getProduct().subscribe(),this._sanphamService.products$.subscribe(t=>this.products=t),this.donhangService.getDonhang().subscribe(),this.donhangService.donhang$.subscribe(t=>{t&&(this.DonHangs=t,console.log(t),this.dataSource=new c.by(this.DonHangs),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)}),this._linkService.getLink().subscribe()}Findbyid(t,n){const i=n.find(a=>a.id==t);return i?i.Tieude:""}Daxem(t,n,i){delete t.Donhangchitiets,t[n]=i,this.donhangService.updateDonhang(t).subscribe()}UpdateStatus(t,n,i){delete t.Donhangchitiets,t[n]=i,this.donhangService.updateDonhang(t).subscribe(a=>{this._notifierService.notify("success","C\u1eadp Nh\u1eadt Th\xe0nh C\xf4ng")})}selectTrangthai(t,n){console.log(t),console.log(n),3==n&&(this.customer_diem.idUser=t.idKH,this.customer_diem.idDonHang=t.id,this.customer_diem.Diemcap=this.customer_diem.Diemqua=t.Donhangchitiets.reduce((i,a)=>i+a.Dongia,0)/1e4,this._tichdiemService.createTichdiem(this.customer_diem).subscribe(i=>{this._tichdiemService.getCustomerByidUser(i.idUser).subscribe(a=>{a?(this.customer=a,this.customer.TongDiemcap+=i.Diemcap,this.customer.TongDiemqua+=i.Diemqua,this._tichdiemService.updateCustomer(this.customer).subscribe(s=>{this.customer={}}),this.ngOnInit()):(this.customer.idUser=i.idUser,this.customer.TongDiemcap=i.Diemcap,this.customer.TongDiemqua=i.Diemqua,this._tichdiemService.createCustomer(this.customer).subscribe(s=>{this.customer={}}),this.ngOnInit())})})),delete t.Donhangchitiets,t.Trangthai=n,this.donhangService.updateDonhang(t).subscribe(),this._notifierService.notify("success","C\u1eadp Nh\u1eadt \u0110\u01a1n H\xe0ng Th\xe0nh C\xf4ng")}nest=(t,n="",i="pid")=>t?.filter(a=>a[i]==n).map(a=>({...a,children:this.nest(t,a.id)}));getParent(t,n){let i=t.find(a=>a.pid==n);return i&&(this.arr.push(i),this.getParent(t,i.id)),i}openDialog(t,n){this.dataSourceTree.data=[],this.arr=[],this.dialog.open(n),this._linkService.getLinkDetail(t.idGioithieu).subscribe(i=>{i&&this._linkService.links$.subscribe(a=>{if(a){if(""!=i.pid){let s=a.find(l=>l.id==i.pid);this.arr.push(s)}this.arr.push(i),i.isCheck=!0,this.getParent(a,i.id),this.dataSourceTree.data=this.nest(this.arr)}})})}SelectDonhang(t){this.dataSource1=new c.by(t.Donhangchitiets)}applyFilter(t){this.dataSource.filter=t.target.value.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}toggle(t,n){this.selectRow=n,this.triggerOrigin=t,this.isOpen=!this.isOpen}filterDonhang(t){this.dataSource=new c.by(this.DonHangs.filter(n=>n.Hoten.toLowerCase().includes(t))),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}static \u0275fac=function(n){return new(n||g)(e.\u0275\u0275directiveInject(d.qu),e.\u0275\u0275directiveInject(b.f),e.\u0275\u0275directiveInject(y.M),e.\u0275\u0275directiveInject(E.M),e.\u0275\u0275directiveInject(I.lG),e.\u0275\u0275directiveInject(O.n),e.\u0275\u0275directiveInject(k.uw))};static \u0275cmp=e.\u0275\u0275defineComponent({type:g,selectors:[["tazagroup-donhang"]],viewQuery:function(n,i){if(1&n&&(e.\u0275\u0275viewQuery(x.NW,5),e.\u0275\u0275viewQuery(T.YE,5)),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.paginator=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.sort=a.first)}},decls:59,vars:8,consts:[["autosize","",1,"example-container","flex","flex-col","flex-auto","w-full","min-h-[80vh]"],["mode","side","position","end",1,"example-sidenav","lg:w-2/3","w-full"],["drawer",""],[1,"absolute","z-10"],[1,"material-icons","p-3","hover:bg-gray-200","rounded-full",3,"click"],[1,"flex","flex-col","w-full"],[1,"relative","border-b-2","flex","flex-col"],[1,"flex","flex-col","p-3","items-center","justify-between","w-full"],["appearance","outline",1,"w-full","text-xs"],["matInput","","placeholder","M\xf4 T\u1ea3",1,"w-full",3,"keyup"],["matPrefix","",1,"material-icons","mr-2"],[1,"flex","flex-row","space-x-3","justify-start","w-full"],[1,"flex","items-center","space-x-2","p-2","hover:bg-gray-200","rounded-lg"],["matTooltip","T\xf9y Ch\u1ec9nh",1,"material-icons","text-xl"],[1,"text-sm"],["matTooltip","L\u1ea5y M\u1eabu",1,"material-icons","text-xl"],["matTooltip","Upload File",1,"material-icons","text-xl"],["matTooltip","T\u1ea1o m\u1edbi",1,"material-icons","text-xl"],[1,"w-full","overflow-auto"],["mat-table","",1,"mat-elevation-z8","w-full",3,"dataSource"],["matColumnDef","MaDonHang"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"routerLink","click",4,"matCellDef"],["matColumnDef","Hoten"],["mat-cell","",4,"matCellDef"],["matColumnDef","Diachi"],["matColumnDef","Ghichu"],["matColumnDef","Trangthai"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["pageSize","10",3,"pageSizeOptions"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","backdropClick"],["mat-header-cell",""],["mat-cell","",3,"routerLink","click"],[1,"flex","flex-col"],[1,"flex","items-center","space-x-2","justify-left"],["class","material-icons text-sm text-blue-500","matTooltip","\u0110\xe3 Xem",4,"ngIf"],["matTooltip","\u0110\xe3 Xem",1,"material-icons","text-sm","text-blue-500"],["mat-cell",""],[1,"flex","flex-col","p-2"],[1,"flex","flex-row","w-full","items-center"],["appearance","outline",1,"w-full"],["matInput","","rows","1",3,"value","ngModel","ngModelChange"],["mat-icon-button","",1,"hover:bg-blue-200",3,"click"],[1,"material-icons","text-sm"],["mat-button","",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["cdkOverlayOrigin","",3,"click"],["triggerTaotailieu","cdkOverlayOrigin"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"],[1,"max-h-64","py-2","bg-white","shadow","space-y-2","overflow-y-auto","rounded-md"],[3,"class","click",4,"ngFor","ngForOf"],[3,"click"]],template:function(n,i){if(1&n){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-drawer-container",0)(1,"mat-drawer",1,2)(3,"div",3)(4,"span",4),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(a);const l=e.\u0275\u0275reference(2);return e.\u0275\u0275resetView(l.close())}),e.\u0275\u0275text(5," arrow_forward "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(6,"router-outlet"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",5)(8,"div",6)(9,"div",7)(10,"mat-form-field",8)(11,"mat-label"),e.\u0275\u0275text(12,"Ti\xeau \u0110\u1ec1"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"input",9),e.\u0275\u0275listener("keyup",function(l){return i.applyFilter(l)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"span",10),e.\u0275\u0275text(15,"search"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(16,"div",11)(17,"div",12)(18,"span",13),e.\u0275\u0275text(19,"tune"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"span",14),e.\u0275\u0275text(21,"C\u1ea5u H\xecnh"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(22,"div",12)(23,"span",15),e.\u0275\u0275text(24,"file_download"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"span",14),e.\u0275\u0275text(26,"Download"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(27,"div",12)(28,"span",16),e.\u0275\u0275text(29,"file_upload"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(30,"span",14),e.\u0275\u0275text(31,"Upload"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(32,"div",12)(33,"span",17),e.\u0275\u0275text(34,"add_circle"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(35,"span",14),e.\u0275\u0275text(36,"Th\xeam"),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(37,"div",18)(38,"table",19),e.\u0275\u0275elementContainerStart(39,20),e.\u0275\u0275template(40,G,2,0,"th",21),e.\u0275\u0275template(41,U,9,9,"td",22),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(42,23),e.\u0275\u0275template(43,z,2,0,"th",21),e.\u0275\u0275template(44,N,8,6,"td",24),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(45,25),e.\u0275\u0275template(46,L,2,0,"th",21),e.\u0275\u0275template(47,J,12,6,"td",24),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(48,26),e.\u0275\u0275template(49,K,2,0,"th",21),e.\u0275\u0275template(50,X,1,0,"td",24),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(51,27),e.\u0275\u0275template(52,W,2,0,"th",21),e.\u0275\u0275template(53,Y,9,10,"td",24),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275template(54,q,1,0,"tr",28),e.\u0275\u0275template(55,ee,1,0,"tr",29),e.\u0275\u0275template(56,te,3,0,"tr",30),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(57,"mat-paginator",31),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(58,ie,2,1,"ng-template",32),e.\u0275\u0275listener("backdropClick",function(){return i.isOpen=!i.isOpen})}2&n&&(e.\u0275\u0275advance(38),e.\u0275\u0275property("dataSource",i.dataSource),e.\u0275\u0275advance(16),e.\u0275\u0275property("matHeaderRowDef",i.displayedColumns),e.\u0275\u0275advance(1),e.\u0275\u0275property("matRowDefColumns",i.displayedColumns),e.\u0275\u0275advance(2),e.\u0275\u0275property("pageSizeOptions",e.\u0275\u0275pureFunction0(7,ae)),e.\u0275\u0275advance(1),e.\u0275\u0275property("cdkConnectedOverlayHasBackdrop",!0)("cdkConnectedOverlayOrigin",i.triggerOrigin)("cdkConnectedOverlayOpen",i.isOpen))},dependencies:[m.sg,m.O5,d.Fj,d.JJ,d.On,$.lW,C.KE,C.hX,C.qo,A.Nt,D.VK,D.OP,D.p6,x.NW,H.jA,H.kh,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,c.Ee,B.gM,F.pI,F.xu,u.lC,u.rH,m.uU]})}var re=o(4850);function oe(r,t){if(1&r&&(e.\u0275\u0275elementStart(0,"div",9)(1,"div"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",10)(4,"div",11),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"number"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",6),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"number"),e.\u0275\u0275elementEnd()()()),2&r){const n=t.$implicit,i=t.index;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2("",i+1," ",n.Product.Tieude,""),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate2("",n.Soluong,"x",e.\u0275\u0275pipeBind2(6,5,n.Dongia,"1.0-2"),""),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind2(9,8,n.Soluong*n.Dongia,"1.0-2")," \u0111")}}class f{fb;donhangService;_sanphamService;_linkService;_notifierService;_tichdiemService;dialog;route;displayedColumns1=["TenSP","Soluong","Dongia","Ghichu","Trangthai"];dataSource1=new c.by;dataSource;displayedColumns=["Hoten","SDT","Diachi","Ngaytao","Trangthai","action"];TTDonhang=w.C;isOpen=!1;CDonhang;DonHangs=[];products;users={};arr=[];customer={};customer_diem={};landingpageForm;selectRow={};DHChitiet={};paginator;sort;triggerOrigin;_transformer=(t,n)=>({expandable:!!t.children&&t.children.length>0,level:n,...t});treeControl=new _.C2(t=>t.level,t=>t.expandable);treeFlattener=new p.JZ(this._transformer,t=>t.level,t=>t.expandable,t=>t.children);hasChild=(t,n)=>n.expandable;hasNoContent=(t,n)=>""===n.name;dataSourceTree=new p.kc(this.treeControl,this.treeFlattener);constructor(t,n,i,a,s,l,h,le){this.fb=t,this.donhangService=n,this._sanphamService=i,this._linkService=a,this._notifierService=s,this._tichdiemService=l,this.dialog=h,this.route=le}ngOnInit(){this._sanphamService.getProduct().subscribe(),this._sanphamService.products$.subscribe(t=>this.products=t),this.route.params.subscribe(t=>{this.donhangService.getOneDonhang(t.id).subscribe(),this.donhangService.donhang1$.subscribe(n=>{n&&(this.DHChitiet=n,console.log(n.Donhangchitiets),this.dataSource=new c.by(n.Donhangchitiets),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)})}),this._linkService.getLink().subscribe()}Total(t){return t.reduce((n,i)=>n+i.Soluong*i.Dongia,0)}Findbyid(t,n){const i=n.find(a=>a.id==t);return i?i.Tieude:""}selectTrangthai(t,n){3==n&&(this.customer_diem.idUser=t.idKH,this.customer_diem.idDonHang=t.id,this.customer_diem.Diemcap=this.customer_diem.Diemqua=t.Donhangchitiets.reduce((i,a)=>i+a.Dongia,0)/1e4,this._tichdiemService.createTichdiem(this.customer_diem).subscribe(i=>{this._tichdiemService.getCustomerByidUser(i.idUser).subscribe(a=>{a?(this.customer=a,this.customer.TongDiemcap+=i.Diemcap,this.customer.TongDiemqua+=i.Diemqua,this._tichdiemService.updateCustomer(this.customer).subscribe(s=>{this.customer={}}),this.ngOnInit()):(this.customer.idUser=i.idUser,this.customer.TongDiemcap=i.Diemcap,this.customer.TongDiemqua=i.Diemqua,this._tichdiemService.createCustomer(this.customer).subscribe(s=>{this.customer={}}),this.ngOnInit())})})),delete t.Donhangchitiets,t.Trangthai=n,this.donhangService.updateDonhang(t).subscribe(),this._notifierService.notify("success","C\u1eadp Nh\u1eadt \u0110\u01a1n H\xe0ng Th\xe0nh C\xf4ng")}nest=(t,n="",i="pid")=>t?.filter(a=>a[i]==n).map(a=>({...a,children:this.nest(t,a.id)}));getParent(t,n){let i=t.find(a=>a.pid==n);return i&&(this.arr.push(i),this.getParent(t,i.id)),i}openDialog(t,n){this.dataSourceTree.data=[],this.arr=[],this.dialog.open(n),this._linkService.getLinkDetail(t.idGioithieu).subscribe(i=>{i&&this._linkService.links$.subscribe(a=>{if(a){if(""!=i.pid){let s=a.find(l=>l.id==i.pid);this.arr.push(s)}this.arr.push(i),i.isCheck=!0,this.getParent(a,i.id),this.dataSourceTree.data=this.nest(this.arr)}})})}SelectDonhang(t){this.dataSource1=new c.by(t.Donhangchitiets)}applyFilter(t){this.dataSource.filter=t.target.value.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}toggle(t,n){this.selectRow=n,this.triggerOrigin=t,this.isOpen=!this.isOpen}filterDonhang(t){this.dataSource=new c.by(this.DonHangs.filter(n=>n.Hoten.toLowerCase().includes(t))),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}static \u0275fac=function(n){return new(n||f)(e.\u0275\u0275directiveInject(d.qu),e.\u0275\u0275directiveInject(b.f),e.\u0275\u0275directiveInject(y.M),e.\u0275\u0275directiveInject(E.M),e.\u0275\u0275directiveInject(I.lG),e.\u0275\u0275directiveInject(O.n),e.\u0275\u0275directiveInject(k.uw),e.\u0275\u0275directiveInject(u.gz))};static \u0275cmp=e.\u0275\u0275defineComponent({type:f,selectors:[["tazagroup-chitiet"]],viewQuery:function(n,i){if(1&n&&(e.\u0275\u0275viewQuery(x.NW,5),e.\u0275\u0275viewQuery(T.YE,5)),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.paginator=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.sort=a.first)}},decls:24,vars:12,consts:[[1,"flex","flex-col","w-full","p-4"],[1,"text-xl","text-center","py-4","font-bold"],[1,"flex","flex-row","space-x-2"],[1,"flex","flex-col","space-y-2","bg-white","p-6","rounded-md","shadow"],["class","flex flex-col",4,"ngFor","ngForOf"],[1,"flex","flex-row","justify-between","font-bold"],[1,"text-blue-500"],[1,"flex","flex-col","space-y-3","bg-white","p-6","rounded-md","shadow","w-2/5"],[1,"flex","flex-row"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between"],[1,"italic"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275text(2,"\u0110\u01a1n h\xe0ng chi ti\u1ebft"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",2)(4,"div",3),e.\u0275\u0275template(5,oe,10,11,"div",4),e.\u0275\u0275element(6,"mat-divider"),e.\u0275\u0275elementStart(7,"div",5)(8,"div"),e.\u0275\u0275text(9,"T\u1ed5ng C\u1ed9ng"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"div",6),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"number"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(13,"div",7)(14,"div"),e.\u0275\u0275text(15,"Kh\xe1ch h\xe0ng"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",8),e.\u0275\u0275text(17),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"div",8),e.\u0275\u0275text(19),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"div",8),e.\u0275\u0275text(21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(22,"div",8),e.\u0275\u0275text(23),e.\u0275\u0275elementEnd()()()()),2&n&&(e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",i.DHChitiet.Donhangchitiets),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind2(12,9,i.Total(i.DHChitiet.Donhangchitiets),"1.0-2"),"\u0111 \u0111"),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" M\xe3 \u0110\u01a1n : ",i.DHChitiet.MaDonHang," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("H\u1ecd T\xean : ",i.DHChitiet.Hoten,""),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("S\u1ed1 \u0110i\u1ec7n Tho\u1ea1i : ",i.DHChitiet.SDT,""),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate4("\u0110\u1ecba Ch\u1ec9 : ",i.DHChitiet.Diachi.Diachi+","||0," ",i.DHChitiet.Diachi.Phuong+","||0," ",i.DHChitiet.Diachi.Quan+","||0," ",i.DHChitiet.Diachi.Tinh||""," "))},dependencies:[m.sg,re.d,m.JJ]})}class v{static \u0275fac=function(n){return new(n||v)};static \u0275mod=e.\u0275\u0275defineNgModule({type:v});static \u0275inj=e.\u0275\u0275defineInjector({imports:[m.ez,d.u5,M.JF,j.MaterialModule,d.UX,P.kz,V.Z_,u.Bz.forChild([{path:"",component:g,children:[{path:":id",component:f}]}]),u.Bz]})}}}]);